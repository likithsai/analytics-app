(()=>{"use strict";var t,e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},s={};e.d(s,{default:()=>u}),function(t){t.PAGE_VIEW="page_view",t.CUSTOM="event",t.GOAL="goal",t.ECOMMERCE="ecommerce",t.VISIBILITY="visibility",t.FOCUS="focus",t.BLUR="blur",t.ENGAGEMENT="engagement",t.PERFORMANCE="performance",t.HEATMAP="heatmap",t.RESOURCE_ERROR="resource_error",t.JS_ERROR="js_error"}(t||(t={}));const i={siteId:"",collectionEndpoint:"https://your-analytics-server.com/collectlikith",batchSize:15,flushInterval:5e3,debug:!1,trackOutlinks:!0,trackDownloads:!0,scrollDepthPercentages:[25,50,75,100],maxHeatmapPoints:500,retryBackoffBaseMs:500,retryMaxAttempts:4},n=()=>Date.now();function o(t,e=200){let s=0;return(...i)=>{const n=Date.now();n-s>=e&&(s=n,t(...i))}}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function r(){const t=new URLSearchParams(location.search),e={};return["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(s=>{const i=t.get(s);i&&(e[s]=i)}),e}class c{constructor(t,e,s=i.retryBackoffBaseMs,n=i.retryMaxAttempts){this.endpoint=t,this.debug=e,this.backoffBaseMs=s,this.maxAttempts=n}log(...t){this.debug&&console.log("[Analytics][Transport]",...t)}async send(t,e=!1){if(e&&"undefined"!=typeof navigator&&"function"==typeof navigator.sendBeacon)try{const e=navigator.sendBeacon(this.endpoint,new Blob([t],{type:"application/json"}));if(this.log("sendBeacon result:",e),e)return}catch(t){this.log("sendBeacon threw",t)}let s=0,i=this.backoffBaseMs;for(;s<this.maxAttempts;)try{s++;const i=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:t,keepalive:e});if(!i.ok)throw new Error(`HTTP ${i.status}`);return void this.log("fetch success",i.status)}catch(t){if(this.log(`fetch attempt ${s} failed`,t),s>=this.maxAttempts)throw t;const e=Math.round(Math.random()*i);await new Promise(t=>setTimeout(t,i+e)),i*=2}}}class h{constructor(t={}){this.queue=[],this.timerId=null,this.customDims={},this.hasConsent=!1,this.sessionId="",this.startTs=n(),this.heatmapBuffer=[],this.scrollDepthReached=new Set,this.config={...i,...t},this.transport=new c(this.config.collectionEndpoint,this.config.debug,this.config.retryBackoffBaseMs,this.config.retryMaxAttempts),this.initLightListeners(),this.startAutoFlush()}setSiteId(t){t&&(this.config.siteId=t,this.debug("siteId set to",t))}grantConsent(){this.hasConsent||(this.hasConsent=!0,this.sessionId=this.createOrRestoreSession(),this.debug("consent granted, sessionId:",this.sessionId),this.initConsentListeners())}setCustomDimension(t,e){t&&(this.customDims[t]=e)}trackPage(e,s){var i,n;const o=this.buildEvent(t.PAGE_VIEW,{url:e||(null!==(i=location.href)&&void 0!==i?i:""),title:s||(null!==(n=document.title)&&void 0!==n?n:""),referrer:document.referrer||null});this.enqueue(o)}trackEvent(e,s,i,n,o){const a=this.buildEvent(t.CUSTOM,{payload:{category:e,action:s,label:i,value:n,extra:o}});this.enqueue(a)}trackEcommerce(e,s){const i=this.buildEvent(t.ECOMMERCE,{payload:{eventName:e,data:s}});this.enqueue(i)}trackGoal(e,s,i){const n=this.buildEvent(t.GOAL,{payload:{goalId:e,revenue:s,data:i}});this.enqueue(n)}flushNow(){this.flush(!1).catch(t=>this.debug("flushNow error",t))}debug(...t){this.config.debug&&console.log("[Analytics]",...t)}createOrRestoreSession(){const t="analytics_session_v1";try{let e=sessionStorage.getItem(t);return e||(e=a(),sessionStorage.setItem(t,e)),e}catch(t){return this.debug("sessionStorage not available",t),a()}}buildEvent(t,e={}){var s,i,o,a,c;return{type:t,ts:n(),url:e.url||(null!==(s=location.href)&&void 0!==s?s:""),title:e.title||(null!==(i=document.title)&&void 0!==i?i:void 0),device:/Mobi|Android/i.test(navigator.userAgent)?"mobile":"web",referrer:e.referrer||(null!==(o=document.referrer)&&void 0!==o?o:null),siteId:this.config.siteId||void 0,sessionId:this.sessionId||void 0,utm:r(),customDims:Object.keys(this.customDims).length?{...this.customDims}:void 0,payload:null!==(a=e.payload)&&void 0!==a?a:void 0,userAgent:null!==(c=navigator.userAgent)&&void 0!==c?c:void 0}}enqueue(e){if(!this.config.siteId)return void this.debug("siteId missing — dropping event",e.type);const s=e.type===t.PAGE_VIEW||e.type===t.PERFORMANCE||e.type===t.ENGAGEMENT;this.hasConsent||s?(this.sessionId&&(e.sessionId=this.sessionId),this.queue.push(e),this.debug("queued",e.type,e),this.queue.length>=this.config.batchSize&&this.flush(!1)):this.debug("consent required — skipping",e.type)}async flush(t=!1){if(!this.queue.length)return;if(!this.config.siteId)return void this.debug("siteId missing at flush");const e=this.queue.slice();this.queue=[];const s=JSON.stringify({siteId:this.config.siteId,ts:n(),events:e});try{await this.transport.send(s,t),this.debug("flushed",e.length)}catch(t){this.queue.unshift(...e),this.debug("flush failed, requeued",t)}}startAutoFlush(){null!=this.timerId&&window.clearInterval(this.timerId);const t=this.config.flushInterval;this.timerId=window.setInterval(()=>{this.flush(!1)},t)}initLightListeners(){this.trackPage(),window.addEventListener("beforeunload",()=>{this.flush(!0)})}initConsentListeners(){const e=function(t,e=100){let s=0;return(...i)=>{clearTimeout(s),s=setTimeout(()=>t(...i),e)}}(()=>this.trackPage(),250);window.addEventListener("popstate",e),window.addEventListener("hashchange",e),document.addEventListener("click",e=>{const s=e.target;if(!s)return;const i={};i.tag=s.tagName,s.id&&(i.id=s.id),s.className&&(i.class="string"==typeof s.className?s.className:void 0),s instanceof HTMLAnchorElement&&(i.href=s.href),this.enqueue(this.buildEvent(t.CUSTOM,{payload:{category:"Interaction",action:"click",details:i}}))},{capture:!0,passive:!0});const s=o(()=>{const t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),e=window.innerHeight||document.documentElement.clientHeight,s=Math.max(0,t-e);if(s<=0)return;const i=window.scrollY||window.pageYOffset||0,n=Math.floor(i/s*100);for(const t of this.config.scrollDepthPercentages)n>=t&&!this.scrollDepthReached.has(t)&&(this.scrollDepthReached.add(t),this.trackEvent("Scroll","DepthReached",`${t}%`,t))},200);window.addEventListener("scroll",s,{passive:!0}),document.addEventListener("keydown",e=>{this.enqueue(this.buildEvent(t.CUSTOM,{payload:{category:"Keyboard",action:"keydown",label:e.key}}))}),document.addEventListener("submit",t=>{const e=t.target;e&&this.trackEvent("Form","Submit",e.name||e.id||"anonymous_form")},!0),document.addEventListener("visibilitychange",()=>{this.enqueue(this.buildEvent(t.VISIBILITY,{payload:{state:document.visibilityState}}))});const i=o(e=>{if(this.heatmapBuffer.push({x:e.clientX,y:e.clientY,ts:n()}),this.heatmapBuffer.length>=this.config.maxHeatmapPoints){const e=this.heatmapBuffer.splice(0,this.heatmapBuffer.length);this.enqueue(this.buildEvent(t.HEATMAP,{payload:{points:e.slice(0,200)}}))}},200);document.addEventListener("mousemove",i,{passive:!0}),window.addEventListener("error",e=>{var s,i;const n=e.target,o=e;if(n&&n instanceof HTMLScriptElement){const e=n.src||"";this.enqueue(this.buildEvent(t.RESOURCE_ERROR,{payload:{tag:"script",url:e}}))}else if(n&&n instanceof HTMLImageElement){const e=n.src||"";this.enqueue(this.buildEvent(t.RESOURCE_ERROR,{payload:{tag:"img",url:e}}))}else if(n&&n instanceof HTMLLinkElement){const e=n.href||"";this.enqueue(this.buildEvent(t.RESOURCE_ERROR,{payload:{tag:"link",url:e}}))}else if(o&&o.error){const e=null!==(i=null===(s=o.error)||void 0===s?void 0:s.message)&&void 0!==i?i:o.message,n=o.error&&o.error.stack?String(o.error.stack).slice(0,2e3):void 0;this.enqueue(this.buildEvent(t.JS_ERROR,{payload:{message:e,stack:n}}))}},!0)}}window.analytics=h;const u=h;window.analytics=s.default})();